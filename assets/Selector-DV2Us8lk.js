import{b as e}from"./vue-B0d-ytHW.js";import{P as l}from"./ProductCard-G5hbPz6W.js";import{b as a,f as t}from"./dataService-CQiVhu7t.js";import"./index-CNMiXLCw.js";import{d as s,r as i,b as u,C as o,f as n,t as d,g as r,k as c,l as m,D as p,F as v,v as h,x as f,j as g,I as _,q as y,y as b}from"./element-0EaUjS1Y.js";import{_ as V}from"./index-uDOMh21w.js";import"./helpers-DDI8N1dV.js";import"./vendor-VSpmzgsF.js";const k={class:"selector-page"},x={class:"step-content"},S={key:0,class:"step-panel"},w={key:1,class:"step-panel"},A={key:2,class:"step-panel"},C={class:"toggle-group"},j={key:3,class:"step-panel"},U={class:"result-header"},I={class:"recommend-card"},P={class:"match-info"},T={class:"score"},H={class:"reasons"},D={key:4,class:"step-actions"},N={class:"content-section"},R={class:"content-section"},E={class:"description"},F=V(s({__name:"Selector",setup(s){const V=e(),F=i(0),L=i([]),M=i([]),q=i(!1),z=i([]),B=u({disease:"",severity:"moderate",budget:8e3,portability:"medium",noiseSensitive:!0,humidification:!0,useCase:"home",experience:"beginner",ahi:void 0}),O=async()=>{if(0!==F.value||B.disease){if(1===F.value){const l="number"!=typeof(e=B.ahi)?null:e>=30?"severe":e>=15?"moderate":"mild";l&&(B.severity=l)}var e;2===F.value&&await J(),F.value<3&&(F.value+=1)}else _.warning("请选择主要问题类型")},$=()=>{F.value>0&&(F.value-=1)},G=()=>{F.value=0,M.value=[]},J=async()=>{q.value=!0,z.value.length||(z.value=await t());const e=z.value.map(e=>{const l=(e=>{var l,a,t;let s=0;const i=[];B.disease&&((e,l)=>!!l&&({ohs:["ohs","obesity_hypoventilation"],sleep_apnea:["sleep_apnea","osa"]}[l]||[l]).some(l=>{var a;return null==(a=e.suitableFor)?void 0:a.includes(l)}))(e,B.disease)&&(s+=30,i.push("疾病匹配度高"));const u=(e=>{var l;return(null==(l=e.type)?void 0:l.includes("双水平"))||"NIV_HOME"===e.deviceType||(e.modeTags||[]).some(e=>["ST","S/T","VAuto","iVAPS","AVAPS"].includes(e))})(e);if("severe"===B.severity?(s+=u?20:10,i.push(u?"重度更偏好双水平/家用NIV":"重度建议更高支持")):"moderate"===B.severity?(s+=u?16:12,i.push(u?"中度可考虑双水平":"中度常规支持")):(s+=u?8:12,i.push(u?"轻度更关注舒适度":"轻度匹配家用场景")),"number"==typeof B.budget&&(e.price>0&&e.price<=B.budget?(s+=15,i.push("价格符合预算")):0===e.price?(s+=7,i.push("价格待补充")):(s+=5,i.push("价格略超预算"))),"travel"===B.useCase||"high"===B.portability?"便携"===e.tag||"PAP_TRAVEL"===e.deviceType||e.name.toLowerCase().includes("mini")?(s+=15,i.push("便携性匹配")):(s+=5,i.push("便携性一般")):(s+=8,i.push("日常使用稳定性优先")),B.noiseSensitive||B.humidification){const u=null==(l=e.specs)?void 0:l["噪音水平"],o=u?Number((null==(a=u.match(/[\d.]+/))?void 0:a[0])||99):99,n=o<=28?6:o<=30?4:2,d=(null==(t=e.specs)?void 0:t["湿化器"])||"",r="一体"===e.humidifier||d.includes("内置")?4:0;s+=n+r,n>=4&&i.push("噪音控制较优"),r>0&&i.push("湿化配置更舒适")}return"beginner"===B.experience?("入门"===e.tag||e.price<=4e3)&&(s+=10,i.push("新手友好")):e.price>=12e3&&(s+=6,i.push("高阶配置适合进阶用户")),{score:Math.min(100,s),reasons:i}})(e);return{...e,matchScore:l.score,matchReasons:l.reasons}});M.value=e.sort((e,l)=>(l.matchScore||0)-(e.matchScore||0)).slice(0,4),q.value=!1};o(async()=>{L.value=await a(),z.value=await t()});const K=[{title:"疾病匹配（30分）",detail:"与适用疾病一致则加分。"},{title:"严重程度（20分）",detail:"根据症状/报告（如AHI）评估。"},{title:"预算匹配（15分）",detail:"预算内得分更高，超预算得分下降。"},{title:"便携需求（15分）",detail:"旅行/便携需求优先便携机型。"},{title:"舒适体验（10分）",detail:"噪音与湿化配置综合评分。"},{title:"使用经验（10分）",detail:"新手优先易上手机型。"}],Q=[{range:"≥ 85",recommendation:"高度匹配：优先重点机型与高配方案"},{range:"70–84",recommendation:"匹配良好：主流机型可优先考虑"},{range:"55–69",recommendation:"基础匹配：建议结合预算与舒适度调整"},{range:"< 55",recommendation:"信息不足：建议补充症状或预算再评估"}],W=[{title:"必须专业评估的情况",description:"以下情况不建议自行选机或调参。",items:["怀疑中枢性呼吸暂停或心衰","持续低氧或明显通气不足","合并神经肌肉疾病"]},{title:"选机不等于参数",description:"推荐结果只是“方向”，参数需要结合评估。",items:["先选模式，再谈压力","面罩适配影响疗效","随访数据比单次更重要"]},{title:"随访是成功关键",description:"稳定使用比一次选对更重要。",items:["适应期 1-2 周高频复盘","关注 AHI/漏气/时长趋势","不适持续要复评"]}];return(e,a)=>{const t=m("el-step"),s=m("el-steps"),i=m("el-radio-button"),u=m("el-radio-group"),o=m("el-input-number"),_=m("el-switch"),z=m("el-button"),J=m("el-skeleton"),X=m("el-col"),Y=m("el-row"),Z=m("el-tag"),ee=m("el-empty"),le=m("el-card");return y(),n("div",k,[a[34]||(a[34]=d("div",{class:"page-header handbook"},[d("p",{class:"header-label"},"智能选机"),d("h1",null,"智能选机 · 先给方向"),d("p",null,"先确定场景与风险，再给可选机型范围。")],-1)),r(le,{class:"selector-container"},{default:c(()=>[r(s,{active:F.value,"align-center":""},{default:c(()=>[r(t,{title:"基础信息"}),r(t,{title:"症状与预算"}),r(t,{title:"使用偏好"}),r(t,{title:"查看推荐"})]),_:1},8,["active"]),d("div",x,[0===F.value?(y(),n("div",S,[a[12]||(a[12]=d("h3",null,"请选择主要问题",-1)),r(u,{modelValue:B.disease,"onUpdate:modelValue":a[0]||(a[0]=e=>B.disease=e),class:"option-group"},{default:c(()=>[(y(!0),n(v,null,h(L.value,e=>(y(),g(i,{key:e.classification||e.id,label:e.classification||String(e.id)},{default:c(()=>[f(b(e.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),a[13]||(a[13]=d("h3",null,"主要使用场景",-1)),r(u,{modelValue:B.useCase,"onUpdate:modelValue":a[1]||(a[1]=e=>B.useCase=e),class:"option-group"},{default:c(()=>[r(i,{label:"home"},{default:c(()=>[...a[9]||(a[9]=[f("居家使用",-1)])]),_:1}),r(i,{label:"travel"},{default:c(()=>[...a[10]||(a[10]=[f("经常出差/旅行",-1)])]),_:1}),r(i,{label:"mixed"},{default:c(()=>[...a[11]||(a[11]=[f("家用 + 便携兼顾",-1)])]),_:1})]),_:1},8,["modelValue"])])):1===F.value?(y(),n("div",w,[a[17]||(a[17]=d("h3",null,"症状严重程度",-1)),r(u,{modelValue:B.severity,"onUpdate:modelValue":a[2]||(a[2]=e=>B.severity=e),class:"option-group"},{default:c(()=>[r(i,{label:"mild"},{default:c(()=>[...a[14]||(a[14]=[f("轻度",-1)])]),_:1}),r(i,{label:"moderate"},{default:c(()=>[...a[15]||(a[15]=[f("中度",-1)])]),_:1}),r(i,{label:"severe"},{default:c(()=>[...a[16]||(a[16]=[f("重度",-1)])]),_:1})]),_:1},8,["modelValue"]),a[18]||(a[18]=d("h3",null,"预算范围（元）",-1)),r(o,{modelValue:B.budget,"onUpdate:modelValue":a[3]||(a[3]=e=>B.budget=e),min:2e3,max:3e4,step:500},null,8,["modelValue"]),a[19]||(a[19]=d("h3",null,"如果已知AHI（可选）",-1)),r(o,{modelValue:B.ahi,"onUpdate:modelValue":a[4]||(a[4]=e=>B.ahi=e),min:0,max:100,step:1},null,8,["modelValue"]),a[20]||(a[20]=d("p",{class:"helper"},"AHI ≥ 30 多为重度；15–29 中度；5–14 轻度。",-1))])):2===F.value?(y(),n("div",A,[a[24]||(a[24]=d("h3",null,"便携需求",-1)),r(u,{modelValue:B.portability,"onUpdate:modelValue":a[5]||(a[5]=e=>B.portability=e),class:"option-group"},{default:c(()=>[r(i,{label:"low"},{default:c(()=>[...a[21]||(a[21]=[f("不需要",-1)])]),_:1}),r(i,{label:"medium"},{default:c(()=>[...a[22]||(a[22]=[f("一般",-1)])]),_:1}),r(i,{label:"high"},{default:c(()=>[...a[23]||(a[23]=[f("非常需要",-1)])]),_:1})]),_:1},8,["modelValue"]),a[25]||(a[25]=d("h3",null,"舒适与体验",-1)),d("div",C,[r(_,{modelValue:B.noiseSensitive,"onUpdate:modelValue":a[6]||(a[6]=e=>B.noiseSensitive=e),"active-text":"对噪音敏感"},null,8,["modelValue"]),r(_,{modelValue:B.humidification,"onUpdate:modelValue":a[7]||(a[7]=e=>B.humidification=e),"active-text":"需要内置加湿"},null,8,["modelValue"]),r(_,{modelValue:B.experience,"onUpdate:modelValue":a[8]||(a[8]=e=>B.experience=e),"active-value":"beginner","inactive-value":"advanced","active-text":"新手用户"},null,8,["modelValue"])])])):(y(),n("div",j,[d("div",U,[a[27]||(a[27]=d("h3",null,"推荐结果",-1)),r(z,{onClick:G},{default:c(()=>[...a[26]||(a[26]=[f("重新评估",-1)])]),_:1})]),q.value?(y(),g(Y,{key:0,gutter:20},{default:c(()=>[(y(),n(v,null,h(4,e=>r(X,{xs:24,sm:12,md:6,key:e},{default:c(()=>[r(J,{rows:6})]),_:1})),64))]),_:1})):(y(),g(Y,{key:1,gutter:20},{default:c(()=>[(y(!0),n(v,null,h(M.value,e=>(y(),g(X,{xs:24,sm:12,md:6,key:e.id},{default:c(()=>[d("div",I,[r(l,{product:e,onDetail:l=>{return a=e.id,void V.push(`/product/${a}`);var a}},null,8,["product","onDetail"]),d("div",P,[d("span",T,"匹配度 "+b(e.matchScore||0),1),d("div",H,[(y(!0),n(v,null,h(e.matchReasons||[],e=>(y(),g(Z,{key:e,size:"small"},{default:c(()=>[f(b(e),1)]),_:2},1024))),128))])])])]),_:2},1024))),128))]),_:1})),q.value||0!==M.value.length?p("",!0):(y(),g(ee,{key:2,description:"暂无推荐结果"}))])),F.value<3?(y(),n("div",D,[r(z,{disabled:0===F.value,onClick:$},{default:c(()=>[...a[28]||(a[28]=[f("上一步",-1)])]),_:1},8,["disabled"]),r(z,{type:"primary",onClick:O},{default:c(()=>[...a[29]||(a[29]=[f("下一步",-1)])]),_:1})])):p("",!0)])]),_:1}),d("div",N,[a[32]||(a[32]=d("h2",null,"评分制选型算法说明",-1)),r(Y,{gutter:20},{default:c(()=>[r(X,{xs:24,md:12},{default:c(()=>[r(le,{shadow:"hover",class:"rule-card"},{default:c(()=>[a[30]||(a[30]=d("h3",null,"评分维度（总分 100）",-1)),d("ul",null,[(y(),n(v,null,h(K,e=>d("li",{key:e.title},[d("strong",null,b(e.title),1),f("："+b(e.detail),1)])),64))])]),_:1})]),_:1}),r(X,{xs:24,md:12},{default:c(()=>[r(le,{shadow:"hover",class:"rule-card"},{default:c(()=>[a[31]||(a[31]=d("h3",null,"推荐阈值",-1)),d("ul",null,[(y(),n(v,null,h(Q,e=>d("li",{key:e.range},[d("strong",null,b(e.range),1),f("："+b(e.recommendation),1)])),64))])]),_:1})]),_:1})]),_:1})]),d("div",R,[a[33]||(a[33]=d("h2",null,"选机提醒与风险提示",-1)),r(Y,{gutter:20},{default:c(()=>[(y(),n(v,null,h(W,e=>r(X,{xs:24,md:8,key:e.title},{default:c(()=>[r(le,{shadow:"hover",class:"rule-card"},{default:c(()=>[d("h3",null,b(e.title),1),d("p",E,b(e.description),1),d("ul",null,[(y(!0),n(v,null,h(e.items,e=>(y(),n("li",{key:e},b(e),1))),128))])]),_:2},1024)]),_:2},1024)),64))]),_:1})])])}}}),[["__scopeId","data-v-8fb561c7"]]);export{F as default};
