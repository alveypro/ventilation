const e=e=>{const i=new Set;return e.filter(e=>!i.has(e.id)&&(i.add(e.id),!0))},i=e=>e.toLowerCase(),t=(e,t)=>{const n=i(e);return t.some(e=>n.includes(e))},n=(e,i,t)=>{const n=e.filter(e=>i.includes(e.category));if(n.length>=t)return n.slice(0,t);const r=e.filter(e=>!i.includes(e.category));return n.concat(r).slice(0,t)},r=(e,i)=>[...e].sort((e,i)=>(i.rating||0)-(e.rating||0)).slice(0,i),s=e=>{var i;const t=e.productId||(null==(i=e.product)?void 0:i._id)||e.product;return"number"==typeof t?t:Number(t)},a=(i,t)=>{const r=t.diseases.filter(e=>{var t;return null==(t=i.suitableFor)?void 0:t.includes(e.classification||"")}),a=t.products.filter(e=>e.brand===i.brand&&e.id!==i.id),c=t.products.filter(e=>e.type===i.type&&e.id!==i.id),l=e([...a,...c]).slice(0,4),o=i.type.includes("双水平")?["intermediate","maintenance"]:["beginner","maintenance"],d=n(t.tutorials,o,3),u=t.reviews.filter(e=>s(e)===i.id);return{diseases:r.slice(0,3),products:l,tutorials:d,reviews:u.slice(0,3)}},c=(i,t)=>{var r;let a=[];(null==(r=i.recommendedMachines)?void 0:r.length)&&(a=i.recommendedMachines.map(e=>t.products.find(i=>i.id===e.id)).filter(Boolean)),a.length||(a=t.products.filter(e=>{var t;return null==(t=e.suitableFor)?void 0:t.includes(i.classification||"")}));const c={sleep_apnea:["beginner","intermediate"],copd:["intermediate","maintenance"],neuromuscular:["intermediate","maintenance"],heart_failure:["intermediate","maintenance"]}[i.classification||""]||["beginner","maintenance"],l=n(t.tutorials,c,3),o=t.reviews.filter(e=>{const i=s(e);return a.some(e=>e.id===i)}),d=e(a.map(e=>t.brands.find(i=>i.name===e.brand)).filter(Boolean)).slice(0,3);return{products:a.slice(0,4),tutorials:l,reviews:o.slice(0,3),brands:d}},l=(e,n)=>{const a=e.content||"",c=i(`${e.title} ${a}`);let l=[];l=t(c,["双水平","bipap","bilevel"])?n.products.filter(e=>e.type.includes("双水平")):t(c,["cpap","压力","auto"])?n.products.filter(e=>e.type.includes("CPAP")):(t(c,["清洁","维护","保养"]),r(n.products,4));const o=n.diseases.filter(e=>{const n=i(e.name||"");return t(c,["osa","睡眠呼吸暂停"])?"sleep_apnea"===e.classification:t(c,["copd","慢阻肺"])?"copd"===e.classification:t(c,["神经肌肉"])?"neuromuscular"===e.classification:t(n,[c])}),d=n.reviews.filter(e=>{const i=s(e);return l.some(e=>e.id===i)});return{products:l.slice(0,4),diseases:o.slice(0,3),reviews:d.slice(0,3)}};export{c as a,l as b,a as g};
