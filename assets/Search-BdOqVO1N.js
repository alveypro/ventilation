import{d as e,r as l,c as n,w as a,C as t,f as s,t as r,g as u,j as i,D as c,x as o,y as d,k as v,l as p,z as m,F as g,v as h,q as y}from"./element-0EaUjS1Y.js";import{b as k,u as f}from"./vue-B0d-ytHW.js";import{f as T,a as L,b as M,c as H,d as _}from"./dataService-CQiVhu7t.js";import{c as w}from"./clinical-handbook-BMS4044B.js";import{p as b}from"./public-user-library-BzewmXVh.js";import{_ as C}from"./index-uDOMh21w.js";import"./index-CNMiXLCw.js";import"./vendor-VSpmzgsF.js";const $={class:"search-page"},j={class:"page-header"},x={key:0,class:"result-count"},q={key:0,class:"external-search"},z={key:1,class:"results"},I={key:0,class:"content-section"},S=["innerHTML"],V=["innerHTML"],F=["innerHTML"],R={key:1,class:"content-section"},U=["innerHTML"],A=["innerHTML"],B=["innerHTML"],D={key:2,class:"content-section"},E=["innerHTML"],G=["innerHTML"],K=["innerHTML"],N={key:3,class:"content-section"},O=["innerHTML"],P=["innerHTML"],J=["innerHTML"],Q={key:4,class:"content-section"},W=["innerHTML"],X=["innerHTML"],Y=["innerHTML"],Z={key:5,class:"content-section"},ee=["innerHTML"],le={class:"result-meta"},ne={key:0},ae={key:1},te={key:2},se=["innerHTML"],re={key:6,class:"content-section"},ue=["innerHTML"],ie={class:"result-meta"},ce={key:0},oe={key:1},de={key:2},ve=["innerHTML"],pe=C(e({__name:"Search",setup(e){const C=f(),pe=k(),me=l(""),ge=l(""),he=l([]),ye=l([]),ke=l([]),fe=l([]),Te=l([]),Le=l(w),Me=l(b),He=e=>e.toLowerCase().replace(/\s+/g," "),_e=(e,l,n)=>{const a=He(e);return l.reduce((e,l)=>a.includes(l)?e+n:e,0)},we=(e,l,n)=>e.map(e=>({item:e,score:l(e,n)})).filter(e=>e.score>0).sort((e,l)=>l.score-e.score).map(e=>e.item),be={osa:["睡眠呼吸暂停","呼吸暂停","睡眠打鼾"],copd:["慢阻肺","慢性阻塞性肺疾病"],cpap:["单水平","持续气道正压"],bipap:["双水平","双水平通气"],vpap:["双水平","医用呼吸机"],rct:["随机对照","临床试验"],niv:["无创通气","无创","非侵袭通气"],hfnc:["高流量","经鼻高流量"],psg:["睡眠监测","多导","多导睡眠监测"],aasm:["睡眠评分","睡眠判读"],mask:["面罩","鼻罩","口鼻罩"],oxygen:["氧疗","制氧","血氧"],apap:["自动调压","自动单水平"],st:["后备频率","双水平ST"]},Ce=e=>{const l=e.split(/[\s,，。；;、/\\|]+/).filter(Boolean).flatMap(e=>{const l=e.toLowerCase();return[l,...be[l]||[]]});return Array.from(new Set(l))},$e=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/'/g,"&#39;"),je=e=>{const l=e||"",n=Ce(He(me.value)).filter(e=>e.length>=2).slice(0,12);if(!n.length)return $e(l);const a=new RegExp(`(${n.map(e=>e.replace(/[.*+?^${}()|[\\]\\\\]/g,"\\\\$&")).join("|")})`,"gi");return $e(l).replace(a,"<mark>$1</mark>")},xe=n(()=>{const e=Ce(He(me.value));return e.length?we(he.value,(e,l)=>{var n,a,t;let s=0;return s+=_e(e.name,l,8),s+=_e(e.brand,l,5),s+=_e(e.type,l,4),s+=_e(e.description,l,3),s+=_e(e.series||"",l,4),s+=_e(e.platformFamily||"",l,3),s+=_e((null==(n=e.modeTags)?void 0:n.join(" "))||"",l,2),s+=_e((null==(a=e.aliasNames)?void 0:a.join(" "))||"",l,2),s+=_e(Object.values(e.specs||{}).join(" ")||"",l,2),s+=_e((null==(t=e.highlights)?void 0:t.join(" "))||"",l,2),s},e):[]}),qe=n(()=>{const e=Ce(He(me.value));return e.length?we(ye.value,(e,l)=>{let n=0;return n+=_e(e.name,l,8),n+=_e(e.country,l,3),n+=_e(e.description,l,3),n},e):[]}),ze=n(()=>{const e=Ce(He(me.value));return e.length?we(ke.value,(e,l)=>{var n,a;let t=0;return t+=_e(e.name,l,8),t+=_e(e.classification||"",l,3),t+=_e(e.description,l,4),t+=_e((null==(n=e.symptoms)?void 0:n.join(" "))||"",l,2),t+=_e((null==(a=e.causes)?void 0:a.join(" "))||"",l,2),t},e):[]}),Ie=n(()=>{const e=Ce(He(me.value));return e.length?we(fe.value,(e,l)=>{let n=0;return n+=_e(e.title,l,8),n+=_e(e.category,l,3),n+=_e(e.content,l,2),n},e):[]}),Se=n(()=>{const e=Ce(He(me.value));return e.length?we(Te.value,(e,l)=>{let n=0;return n+=_e(e.title||"",l,6),"summary"in e&&(n+=_e(e.summary||"",l,3)),n+=_e(e.content||"",l,2),n+=_e(e.category||"",l,2),n},e):[]}),Ve=n(()=>{const e=Ce(He(me.value));return e.length?we(Le.value,(e,l)=>_e(e.title||"",l,6)+_e(e.summary||"",l,3),e):[]}),Fe=n(()=>{const e=Ce(He(me.value));return e.length?we(Me.value,(e,l)=>_e(e.title||"",l,6)+_e(e.summary||"",l,3),e):[]}),Re=n(()=>xe.value.length+qe.value.length+ze.value.length+Ie.value.length+Se.value.length+Ve.value.length+Fe.value.length),Ue=e=>{if(!me.value)return;const l=encodeURIComponent(me.value),n={baidu:`https://www.baidu.com/s?wd=${l}`,bing:`https://www.bing.com/search?q=${l}`,google:`https://www.google.com/search?q=${l}`};window.open(n[e],"_blank","noopener")},Ae=()=>{const e=ge.value.trim();e&&pe.push({path:"/search",query:{q:e}})},Be=e=>{pe.push(e)},De=e=>{const l=e.replace(/[#*`>\-]/g,"").replace(/\s+/g," ").trim();return l.slice(0,80)+(l.length>80?"...":"")};return a(()=>C.query.q,()=>{const e=C.query.q;me.value="string"==typeof e?e.trim():"",ge.value=me.value},{immediate:!0}),t(async()=>{const[e,l,n,a,t]=await Promise.all([T(),L(),M(),H(),_()]);he.value=e,ye.value=l,ke.value=n,fe.value=a,Te.value=t}),(e,l)=>{const n=p("el-button"),a=p("el-input"),t=p("el-card"),k=p("el-empty"),f=p("el-col"),T=p("el-row");return y(),s("div",$,[r("div",j,[l[5]||(l[5]=r("h1",null,"全站搜索",-1)),r("p",null,[l[4]||(l[4]=o("关键词：",-1)),r("strong",null,d(me.value||"—"),1)]),me.value?(y(),s("p",x,"共 "+d(Re.value)+" 条结果",1)):c("",!0)]),u(t,{class:"search-bar"},{default:v(()=>[u(a,{modelValue:ge.value,"onUpdate:modelValue":l[0]||(l[0]=e=>ge.value=e),placeholder:"输入关键词",onKeyup:m(Ae,["enter"])},{append:v(()=>[u(n,{type:"primary",onClick:Ae},{default:v(()=>[...l[6]||(l[6]=[o("搜索",-1)])]),_:1})]),_:1},8,["modelValue"]),me.value?(y(),s("div",q,[l[10]||(l[10]=r("span",{class:"external-label"},"站外搜索",-1)),u(n,{size:"small",onClick:l[1]||(l[1]=e=>Ue("baidu"))},{default:v(()=>[...l[7]||(l[7]=[o("百度",-1)])]),_:1}),u(n,{size:"small",onClick:l[2]||(l[2]=e=>Ue("bing"))},{default:v(()=>[...l[8]||(l[8]=[o("必应",-1)])]),_:1}),u(n,{size:"small",onClick:l[3]||(l[3]=e=>Ue("google"))},{default:v(()=>[...l[9]||(l[9]=[o("Google",-1)])]),_:1})])):c("",!0)]),_:1}),me.value?(y(),s(g,{key:1},[0===Re.value?(y(),i(k,{key:0,description:"未找到相关内容"})):(y(),s("div",z,[xe.value.length?(y(),s("div",I,[l[11]||(l[11]=r("h2",null,"产品库",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(xe.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>Be(`/product/${e.id}`)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.name)},null,8,S),r("div",{class:"result-meta",innerHTML:je(`${e.brand} · ${e.type}`)},null,8,V),r("div",{class:"result-desc",innerHTML:je(e.description)},null,8,F)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0),qe.value.length?(y(),s("div",R,[l[12]||(l[12]=r("h2",null,"品牌库",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(qe.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>Be(`/brand/${e.id}`)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.name)},null,8,U),r("div",{class:"result-meta",innerHTML:je(e.country)},null,8,A),r("div",{class:"result-desc",innerHTML:je(e.description)},null,8,B)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0),ze.value.length?(y(),s("div",D,[l[13]||(l[13]=r("h2",null,"疾病指南",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(ze.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>Be(`/disease/${e.id}`)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.name)},null,8,E),r("div",{class:"result-meta",innerHTML:je(`${e.severity} · ${e.classification||"疾病指南"}`)},null,8,G),r("div",{class:"result-desc",innerHTML:je(e.description)},null,8,K)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0),Ie.value.length?(y(),s("div",N,[l[14]||(l[14]=r("h2",null,"使用教程",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(Ie.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>Be(`/tutorial/${e.id}`)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.title)},null,8,O),r("div",{class:"result-meta",innerHTML:je(`${e.category} · ${e.difficulty}`)},null,8,P),r("div",{class:"result-desc",innerHTML:je(De(e.content))},null,8,J)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0),Se.value.length?(y(),s("div",Q,[l[15]||(l[15]=r("h2",null,"测评中心",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(Se.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>(e=>{"productId"in e&&e.productId?pe.push(`/product/${e.productId}`):pe.push("/reviews")})(e)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.title||"")},null,8,W),r("div",{class:"result-meta",innerHTML:je(`${e.category||""} · 评分 ${e.rating||""}`)},null,8,X),r("div",{class:"result-desc",innerHTML:je(e.summary||e.content||"")},null,8,Y)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0),Ve.value.length?(y(),s("div",Z,[l[17]||(l[17]=r("h2",null,"临床知识库",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(Ve.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>Be(`/clinical/${e.id}`)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.title||"")},null,8,ee),r("div",le,[l[16]||(l[16]=o(" 临床 ",-1)),e.category?(y(),s("span",ne,"· "+d(e.category),1)):c("",!0),e.level?(y(),s("span",ae,"· "+d(e.level),1)):c("",!0),e.docType?(y(),s("span",te,"· "+d(e.docType),1)):c("",!0)]),r("div",{class:"result-desc",innerHTML:je(e.summary||"")},null,8,se)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0),Fe.value.length?(y(),s("div",re,[l[19]||(l[19]=r("h2",null,"用户知识库",-1)),u(T,{gutter:20},{default:v(()=>[(y(!0),s(g,null,h(Fe.value,e=>(y(),i(f,{xs:24,sm:12,md:8,key:e.id},{default:v(()=>[u(t,{shadow:"hover",class:"result-card",onClick:l=>Be(`/user-knowledge/${e.id}`)},{default:v(()=>[r("div",{class:"result-title",innerHTML:je(e.title||"")},null,8,ue),r("div",ie,[l[18]||(l[18]=o(" 用户 ",-1)),e.category?(y(),s("span",ce,"· "+d(e.category),1)):c("",!0),e.level?(y(),s("span",oe,"· "+d(e.level),1)):c("",!0),e.docType?(y(),s("span",de,"· "+d(e.docType),1)):c("",!0)]),r("div",{class:"result-desc",innerHTML:je(e.summary||"")},null,8,ve)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):c("",!0)]))],64)):(y(),i(k,{key:0,description:"请输入关键词开始搜索"}))])}}}),[["__scopeId","data-v-7d8fbacb"]]);export{pe as default};
