import{p as e,a as n,b as t,c as a,d as i,t as r,r as s}from"./index-CNMiXLCw.js";const o=[],d=[{id:1,name:"瑞思迈",country:"澳大利亚",description:"ResMed · 国际品牌 · 灰市与翻新较多；型号地区版本差异大"},{id:2,name:"飞利浦伟康",country:"美国",description:"Philips Respironics · 国际品牌 · 二手/翻新流通多；版本差异与召回历史需提示"},{id:3,name:"瑞迈特",country:"中国",description:"BMC · 国产品牌 · 国产主流平台；电商渠道版本多"},{id:4,name:"鱼跃",country:"中国",description:"Yuwell · 国产品牌 · 型号命名复杂；渠道专供/后缀变体多"},{id:5,name:"律维施泰因",country:"德国",description:"Löwenstein Medical · 国际品牌 · prisma 系列常见；国内多为经销渠道"},{id:6,name:"博毅雅",country:"瑞典",description:"Breas · 国际品牌 · Vivo 系列家用NIV常见"},{id:7,name:"德威比斯",country:"美国",description:"DeVilbiss Healthcare · 国际品牌 · 部分型号在国内跨境/二手流通"},{id:8,name:"亚培克斯",country:"中国台湾",description:"APEX Medical · 国际品牌 · 部分便携/睡眠机在国内电商与跨境流通"},{id:9,name:"比扬",country:"中国",description:"BYOND · 国产品牌 · 部分ODM；电商渠道常见"},{id:10,name:"谊安",country:"中国",description:"Yian · 国产品牌 · 家用无创相关产品线存在；渠道差异大"},{id:11,name:"科司德",country:"中国",description:"Consider · 国产品牌 · 电商常见；贴牌/渠道版本混杂"}],l=[{id:1,name:"睡眠呼吸暂停综合征 (OSA)",classification:"sleep_apnea",severity:"常见",description:"睡眠期间反复出现呼吸暂停/低通气，常伴打鼾与白天嗜睡。",prevalence:"成人群体约10-15%",symptoms:["大声打鼾","夜间呼吸暂停","白天嗜睡","晨起头痛","注意力不集中"],causes:["上气道塌陷","肥胖与颈围增大","鼻阻塞或解剖异常","年龄增长"],diagnosis:["量表筛查（STOP-Bang/ESS）","PSG或HSAT","AHI/ODI/T90评估"],treatment:["PAP治疗（CPAP/APAP）","体重管理与生活方式调整","必要时口腔矫治或手术评估"],sources:[{title:"Sleep Apnea",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],longform:"\n## 一句话定义\nOSA 是睡眠期间因上气道塌陷导致反复呼吸暂停或低通气的常见疾病。\n\n## 诊断路径\n1. 风险筛查（STOP-Bang、ESS）。\n2. PSG 或 HSAT 明确事件与低氧负荷。\n3. 结合 AHI、T90 与症状完成分层。\n\n## 关键指标表\n| 指标 | 含义 | 临床提示 |\n| --- | --- | --- |\n| AHI | 暂停+低通气次数/小时 | 与症状/合并症综合判断 |\n| ODI | 血氧下降次数 | 反映低氧负荷 |\n| T90 | SpO2 < 90% 时间占比 | 低氧严重度 |\n| ArI | 觉醒指数 | 反映睡眠碎片化 |\n\n## 治疗策略\n- 首选 PAP 治疗（CPAP/APAP），改善气道通畅。\n- 合并肥胖者强调体重管理与生活方式干预。\n- 部分患者可评估口腔矫治或手术。\n\n## 随访与疗效\n- 关注依从性（常用口径：每晚 ≥4 小时、每周 ≥5 晚）。\n- 观察症状改善、AHI/ODI 下降与睡眠结构改善。\n\n## 风险与提示\n- 严重低氧、明显心肺合并症需优先就医评估。\n- 参数调整需遵循医嘱与随访数据。\n    ",prognosis:"规范治疗可显著改善症状与心血管风险。",complications:["高血压","心血管疾病","认知受损"],recommendedMachines:[]},{id:2,name:"慢性阻塞性肺疾病 (COPD)",classification:"copd",severity:"严重",description:"气流受限不可完全逆转的慢性疾病。",prevalence:"全球常见慢病之一",symptoms:["慢性咳嗽","咳痰","呼吸困难","活动耐量下降"],causes:["长期吸烟","空气污染","职业粉尘"],diagnosis:["肺功能检查","血气分析","影像学检查"],treatment:["药物治疗与戒烟","氧疗与肺康复","有适应证者使用NIV"],sources:[{title:"Global Strategy for the Diagnosis, Management, and Prevention of COPD (2024 Report)",date:"2024"},{title:"Chronic obstructive pulmonary disease (COPD)",date:"持续更新"}],longform:"\n## 一句话定义\nCOPD 是以不可逆气流受限为特征的慢性呼吸系统疾病。\n\n## 诊断路径\n1. 症状评估（慢性咳嗽、咳痰、气促）。\n2. 肺功能检查明确阻塞程度。\n3. 血气分析与影像学评估并发症。\n\n## 治疗要点\n- 药物治疗与戒烟是基础。\n- 必要时氧疗与肺康复改善运动耐量。\n- 高碳酸血症或通气不足者考虑 NIV。\n\n## 家用NIV关注点\n- 评估适应证与耐受性。\n- 重点关注 IPAP/EPAP 与后备频率。\n- 建立随访节奏，避免 CO2 潴留。\n\n## 随访与风险\n- 监测急性加重（AECOPD）频率与诱因。\n- 注意感染、心肺并发症与营养状态。\n    ",prognosis:"需长期管理，可改善症状与生活质量。",complications:["呼吸衰竭","肺心病","急性加重"],recommendedMachines:[]},{id:3,name:"肥胖低通气综合征 (OHS)",classification:"ohs",severity:"常见",description:"肥胖相关的慢性低通气与高碳酸血症。",prevalence:"肥胖人群风险更高",symptoms:["白天嗜睡","晨起头痛","呼吸困难"],causes:["肥胖相关通气不足","睡眠呼吸障碍共存"],diagnosis:["血气分析","睡眠监测","排除其他原因"],treatment:["体重管理","PAP或NIV治疗","随访与复诊"],sources:[{title:"Clinical Practice Guidelines",date:"持续更新"},{title:"Statements & Guidelines",date:"持续更新"}],longform:"\n## 一句话定义\nOHS 是肥胖相关的慢性低通气综合征，常伴高碳酸血症与睡眠呼吸障碍。\n\n## 诊断路径\n1. 评估肥胖程度与症状（嗜睡、气促）。\n2. 血气分析确认高碳酸血症。\n3. 结合睡眠监测排除或合并 OSA。\n\n## 治疗策略\n- 体重管理是长期基础措施。\n- PAP 或 NIV 改善夜间通气与低氧。\n- 建议建立随访与复诊机制。\n\n## 随访重点\n- CO2 与氧合改善情况。\n- 依从性与面罩耐受度。\n    ",prognosis:"规范治疗可改善通气与症状。",complications:["高碳酸血症","肺动脉高压"],recommendedMachines:[]},{id:4,name:"神经肌肉疾病相关低通气",classification:"neuromuscular",severity:"严重",description:"呼吸肌无力导致通气不足与夜间低氧。",prevalence:"相对少见",symptoms:["夜间低氧","白天嗜睡","呼吸肌疲劳"],causes:["ALS","肌营养不良","重症肌无力"],diagnosis:["肺功能检查","夜间监测","症状评估"],treatment:["NIV通气支持","呼吸肌训练与康复","随访评估"],sources:[{title:"Statements & Guidelines",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],longform:"\n## 一句话定义\n神经肌肉疾病可导致呼吸肌无力，出现夜间低通气与呼吸衰竭风险。\n\n## 诊断路径\n1. 肺功能检查与呼吸肌评估。\n2. 夜间监测与血氧/CO2 评估。\n3. 结合症状与疾病进展判断支持策略。\n\n## 治疗与管理\n- NIV 通气支持是核心手段。\n- 呼吸肌训练与康复辅助改善耐受。\n- 关注排痰与气道廓清。\n\n## 随访重点\n- 通气参数与夜间监测数据。\n- 感染与急性加重风险。\n    ",prognosis:"通气支持可改善生活质量。",complications:["呼吸衰竭","肺部感染"],recommendedMachines:[]},{id:5,name:"中枢性睡眠呼吸暂停 (CSA)",classification:"csa",severity:"中度",description:"中枢驱动不足导致呼吸暂停。",prevalence:"与心衰、药物相关",symptoms:["夜间呼吸不稳定","白天疲劳"],causes:["心衰","脑干病变","阿片类药物"],diagnosis:["PSG判读中枢事件","病因评估"],treatment:["处理原发疾病","专业评估后选择通气策略"],sources:[{title:"Scoring Manual",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],longform:"\n## 一句话定义\nCSA 由中枢驱动不足引起呼吸暂停，需先寻找并处理原发原因。\n\n## 诊断路径\n1. PSG 判读中枢事件比例。\n2. 评估心衰、脑干病变、药物因素等。\n3. 判断是否存在复杂性睡眠呼吸暂停。\n\n## 治疗策略\n- 优先处理原发疾病。\n- 通气策略需专业评估与随访。\n- 高风险模式需严格适应证控制。\n\n## 风险提示\n- 不建议自行调整高级模式参数。\n- 出现心肺症状需及时就医。\n    ",prognosis:"需针对病因管理。",complications:["睡眠碎片化","心血管风险"],recommendedMachines:[]},{id:6,name:"上气道阻力综合征 (UARS)",classification:"uars",severity:"中度",description:"气流受限导致觉醒，但 AHI 可能不高。",prevalence:"较常见但易漏诊",symptoms:["疲劳","睡眠质量差","晨起不适"],causes:["上气道阻力增加"],diagnosis:["PSG判读RERA","症状评估"],treatment:["PAP治疗","改善气道通畅"],sources:[{title:"Scoring Manual",date:"持续更新"},{title:"Sleep Apnea",date:"持续更新"}],longform:"\n## 一句话定义\nUARS 是上气道阻力增加导致觉醒增多的睡眠障碍，AHI 可能不高。\n\n## 诊断路径\n1. 症状评估（疲劳、睡眠质量差）。\n2. PSG 判读 RERA 与流量受限。\n3. 排除其他导致睡眠质量差的因素。\n\n## 治疗策略\n- 改善上气道阻力与鼻阻塞。\n- 必要时尝试 PAP。\n- 强调睡眠卫生与行为干预。\n    ",prognosis:"改善气道后可缓解症状。",complications:["睡眠碎片化"],recommendedMachines:[]}],c=[{id:6001,title:"PAP治疗入门：10分钟快速上手",category:"beginner",difficulty:"基础",duration:"10分钟",views:1200,rating:4.8,sources:[{title:"CPAP",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],content:"\n## 一句话目标\n在 10 分钟内完成开机、面罩佩戴与首次适应，建立正确的使用习惯。\n\n## 准备清单\n- 机器、电源、管路、面罩与水箱。\n- 干净的蒸馏水或清洁水源（按说明）。\n- 安静、平躺的体验环境。\n\n## 快速步骤\n1. 检查电源、管路与水箱是否连接牢固。\n2. 佩戴面罩并调整松紧，确保不压痛。\n3. 开机适应 5-10 分钟，观察漏气与舒适度。\n4. 记录不适与漏气，便于后续调整。\n\n## 正确姿势\n- 仰卧与侧卧各体验 2-3 分钟。\n- 呼气时放松，避免紧绷与屏气。\n\n## 常见问题\n- 觉得憋气：尝试呼气减压或降低压力。\n- 鼻干：适当提高湿化，必要时加温管路。\n- 面罩压痕：重新调整头带或更换尺寸。\n\n## 随访建议\n- 首周以适应为主，逐步延长使用时长。\n- 记录 AHI/漏气变化与主观感受。\n    "},{id:6002,title:"面罩适配与漏气处理",category:"mask",difficulty:"基础",duration:"15分钟",views:980,rating:4.7,sources:[{title:"CPAP",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],content:"\n## 适配步骤\n1. 选择合适面罩类型（鼻枕/鼻罩/全脸罩）。\n2. 按尺寸表匹配并试戴。\n3. 调整头带，避免过紧或过松。\n4. 开机观察漏气与舒适度。\n\n## 漏气排查顺序\n- 先调面罩位置，再调头带松紧。\n- 检查鼻阻塞或口漏。\n- 仍不适时考虑更换面罩类型或尺寸。\n\n## 舒适度优化\n- 面罩边缘不要压到鼻梁。\n- 夜间翻身后重新调整贴合度。\n\n## 常见错误\n- 头带拉得过紧，导致皮肤压痕。\n- 忽视口漏，导致 AHI 下降不明显。\n\n## 随访记录\n- 记录漏气数值与不适位置。\n- 若连续 1-2 周无法改善，考虑重新评估面罩。\n    "},{id:6003,title:"PSG报告速读",category:"psg",difficulty:"基础",duration:"20分钟",views:860,rating:4.6,sources:[{title:"Scoring Manual",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],content:"\n## 关键指标\n- AHI：暂停+低通气次数/小时\n- ODI：血氧下降次数\n- T90：SpO2 < 90% 时间占比\n- ArI：觉醒指数\n\n## 阅读顺序\n睡眠结构 → 事件指标 → 低氧负荷 → 体位/REM\n\n## 判读提示\n- 阻塞性事件：胸腹带仍在努力。\n- 中枢性事件：努力消失。\n- 流量受限：鼻压波形“削顶”。\n\n## 常见误区\n- 仅看 AHI 忽略低氧负荷。\n- 不考虑体位与 REM 加重。\n    "},{id:6004,title:"滴定与调参基础",category:"titration",difficulty:"中级",duration:"30分钟",views:760,rating:4.7,sources:[{title:"Clinical Practice Guidelines",date:"持续更新"},{title:"Scoring Manual",date:"持续更新"}],content:"\n## 调参逻辑\n1. 先解决阻塞（EPAP/CPAP）。\n2. 再解决通气不足（IPAP/PS）。\n3. 最后优化舒适度与漏气。\n\n## 参数记录\n- 记录每次调整后的 AHI、漏气与主观感受。\n- 以最差体位/REM 期为目标覆盖。\n\n## 风险提示\n- 过快提升压力可能导致不耐受。\n- 未处理漏气时调参效果不可靠。\n    "},{id:6005,title:"依从性管理指南",category:"followup",difficulty:"基础",duration:"15分钟",views:680,rating:4.5,sources:[{title:"Clinical Practice Guidelines",date:"持续更新"},{title:"CPAP",date:"持续更新"}],content:"\n## 依从性口径\n常用口径为每晚 ≥4 小时、每周 ≥5 晚。\n\n## 提升策略\n- 适配面罩\n- 改善舒适度\n- 设定随访提醒\n \n## 行为建议\n- 首周以适应为主，逐步延长时长。\n- 记录嗜睡、夜尿、晨起头痛等变化。\n    "},{id:6006,title:"家用NIV入门",category:"niv",difficulty:"中级",duration:"25分钟",views:540,rating:4.6,sources:[{title:"Statements & Guidelines",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],content:"\n## 核心要点\n- 适应证评估与禁忌证排查。\n- IPAP/EPAP 设定与压力支持理解。\n- 备份频率与触发灵敏度。\n\n## 参数设置流程\n1. 明确目标（改善通气/降低 CO2）。\n2. 设定 EPAP 解决阻塞。\n3. 通过 IPAP/PS 改善通气。\n\n## 随访\n2-4 周复盘数据与症状，必要时调整参数。\n    "},{id:6007,title:"加湿与结露处理",category:"comfort",difficulty:"基础",duration:"10分钟",views:520,rating:4.5,sources:[{title:"CPAP",date:"持续更新"},{title:"Clinical Practice Guidelines",date:"持续更新"}],content:"\n## 结露原因\n湿度高 + 环境温度低。\n\n## 解决方式\n- 降低湿化档位。\n- 使用加热管路。\n- 保持室温与管路保温。\n\n## 清洁与维护\n- 水箱每日清洁并晾干。\n- 定期更换过滤棉，避免霉菌滋生。\n    "},{id:6008,title:"安全红线与就医提示",category:"safety",difficulty:"基础",duration:"8分钟",views:450,rating:4.8,sources:[{title:"Clinical Practice Guidelines",date:"持续更新"},{title:"CPAP",date:"持续更新"}],content:"\n## 必须就医的情况\n- 意识改变\n- 持续低氧（SpO2<90%）\n- 严重胸痛或咯血\n\n## 居家红线\n- 设备出现异常报警\n- 参数无法解释的波动\n- 出现严重不适\n\n## 合规提示\n- 本教程不替代医疗诊断。\n- 高风险模式需专业评估与随访。\n    "},{id:6009,title:"加温湿化与鼻干处理",category:"comfort",difficulty:"基础",duration:"12分钟",views:520,rating:4.7,sources:[{title:"Clinical Practice Guidelines",date:"持续更新"},{title:"Sleep Education",date:"持续更新"}],content:"\n## 一句话目标\n通过湿化和环境调整缓解鼻干、咽干与鼻塞，提高依从性。\n\n## 常见原因\n- 湿化不足或水箱缺水。\n- 室内过于干燥（空调/暖气）。\n- 面罩漏气导致气流刺激。\n\n## 操作步骤\n1. 检查水箱是否有足够水量。\n2. 逐级提升湿化档位（每次 1 档）。\n3. 如有加温管路，优先启用以减少冷凝。\n4. 同步检查面罩漏气情况。\n\n## 注意事项\n- 湿化过高会产生冷凝水，需下调或加温管路。\n- 鼻塞明显先处理鼻部问题，再评估压力。\n\n## 随访建议\n- 连续 3-5 天记录湿化档位与鼻干变化。\n    "},{id:6010,title:"滤网与管路清洁清单",category:"maintenance",difficulty:"基础",duration:"10分钟",views:490,rating:4.8,sources:[{title:"Manufacturer Instructions",date:"持续更新"}],content:"\n## 一句话目标\n用可执行清单降低异味、堵塞与感染风险。\n\n## 每日清洁\n- 水箱清洗并晾干。\n- 面罩擦拭，避免油脂堆积。\n\n## 每周清洁\n- 管路用温水清洗并晾干。\n- 过滤棉取出轻拍除尘。\n\n## 更换周期参考\n- 过滤棉：1-3 个月（视灰尘）。\n- 面罩硅胶：3-6 个月。\n- 管路：6-12 个月。\n\n## 常见误区\n- 用酒精/强酸碱清洗硅胶部件。\n- 清洗后未完全晾干直接使用。\n    "},{id:6011,title:"旅行/外出使用准备",category:"travel",difficulty:"基础",duration:"8分钟",views:410,rating:4.6,sources:[{title:"CPAP Travel Checklist",date:"持续更新"}],content:"\n## 一句话目标\n确保外出也能稳定使用，避免断档影响疗效。\n\n## 出行清单\n- 电源与转换插头。\n- 备用面罩/滤网。\n- 水箱与管路。\n\n## 机场/酒店注意\n- 询问电源位置，避免插座不足。\n- 飞行中使用需提前咨询航空公司规则。\n\n## 便携建议\n- 轻量机型优先。\n- 减少配件体积，注意防护。\n    "}],p=[{modelName:"AirSense 10 AutoSet",platformFamily:"ResMed AirSense",deviceType:"PAP_SLEEP",modeTags:["APAP","CPAP"],epapMin:4,epapMax:20,backupRate:!1,targetVentilation:!1,humidifier:"一体",heatedTube:"支持",connectivity:["SD","云"],channels:["电商","线下","灰市","二手"],refurbRisk:"中",overclaimRisk:"低"},{modelName:"AirCurve 10 ST",platformFamily:"ResMed AirCurve",deviceType:"NIV_HOME",modeTags:["S","ST"],ipapMax:25,backupRate:!0,targetVentilation:!1,refurbRisk:"中",overclaimRisk:"低"},{modelName:"Lumis 150 ST",platformFamily:"ResMed Lumis",deviceType:"NIV_HOME",modeTags:["S","ST","iVAPS"],backupRate:!0,targetVentilation:!0,refurbRisk:"中",overclaimRisk:"低"}],m=e=>e.toLowerCase().replace(/\s+/g,""),u=e=>e.map(e=>{const n=p.find(n=>((e,n,t)=>{const a=m(e),i=m(n);return!(!a.includes(i)&&!i.includes(a)&&!(null==t?void 0:t.some(e=>m(e)===a||a.includes(m(e)))))})(e.name,n.modelName,n.aliasNames));return n?{...e,deviceType:n.deviceType??e.deviceType,platformFamily:n.platformFamily??e.platformFamily,status:n.status??e.status,modeTags:n.modeTags??e.modeTags,epapMin:n.epapMin??e.epapMin,epapMax:n.epapMax??e.epapMax,ipapMin:n.ipapMin??e.ipapMin,ipapMax:n.ipapMax??e.ipapMax,backupRate:n.backupRate??e.backupRate,targetVentilation:n.targetVentilation??e.targetVentilation,asv:n.asv??e.asv,humidifier:n.humidifier??e.humidifier,heatedTube:n.heatedTube??e.heatedTube,noiseDb:n.noiseDb??e.noiseDb,weightKg:n.weightKg??e.weightKg,connectivity:n.connectivity??e.connectivity,power:n.power??e.power,channels:n.channels??e.channels,refurbRisk:n.refurbRisk??e.refurbRisk,overclaimRisk:n.overclaimRisk??e.overclaimRisk}:e}),f=[{id:"HM_RES_01",type:"hard",pattern:"(airsense\\s*10|\\bs10\\b).*aut(oset)?",modelId:1,platformId:1,confidence:95},{id:"HM_RES_02",type:"hard",pattern:"(airsense\\s*11|\\bs11\\b).*aut(oset)?",modelId:2,platformId:1,confidence:95},{id:"HM_RES_03",type:"hard",pattern:"(aircurve\\s*10).*vauto",modelId:3,platformId:2,confidence:95},{id:"HM_RES_04",type:"hard",pattern:"(aircurve\\s*10).*\\bst\\b",modelId:4,platformId:2,confidence:92},{id:"HM_RES_05",type:"hard",pattern:"(lumis\\s*150|lumis150).*\\bst\\b",modelId:5,platformId:2,confidence:92},{id:"HM_RES_06",type:"hard",pattern:"\\bairmini\\b|air\\s*mini",modelId:6,platformId:1,confidence:92},{id:"HM_PHI_01",type:"hard",pattern:"dreamstation\\s*2|\\bds2\\b",modelId:8,platformId:3,confidence:90},{id:"HM_PHI_02",type:"hard",pattern:"dreamstation(?!\\s*2)|\\bds\\b.*auto",modelId:7,platformId:3,confidence:85},{id:"HM_PHI_03",type:"hard",pattern:"bipap.*s/?t|\\bst\\b.*bipap",modelId:9,platformId:4,confidence:85},{id:"HM_PHI_04",type:"hard",pattern:"trilogy\\s*100|trilogy100",modelId:10,platformId:4,confidence:90},{id:"HM_BMC_01",type:"hard",pattern:"\\bg3a\\s*20\\b|g3\\s*a20",modelId:13,platformId:7,confidence:90},{id:"HM_BMC_02",type:"hard",pattern:"\\bg3b\\s*25a\\b|g3\\s*b25a",modelId:14,platformId:7,confidence:90},{id:"HM_BMC_03",type:"hard",pattern:"\\bg3b\\s*30vt\\b|g3\\s*b30vt",modelId:15,platformId:7,confidence:90},{id:"HM_YUW_01",type:"hard",pattern:"yh[-\\s]?680d|680d.*鱼跃|鱼跃.*680d",modelId:16,platformId:9,confidence:88},{id:"HM_YUW_02",type:"hard",pattern:"yh[-\\s]?730st|730st.*鱼跃|鱼跃.*730st",modelId:17,platformId:9,confidence:88},{id:"HM_LOW_01",type:"hard",pattern:"prisma\\s*smart|prismasmart",modelId:11,platformId:5,confidence:85},{id:"HM_BRE_01",type:"hard",pattern:"vivo\\s*45|vivo45",modelId:12,platformId:6,confidence:80},{id:"PF_RES_10",type:"platform",pattern:"airsense\\s*(10|11)|\\bs10\\b|\\bs11\\b|aut(oset)?",modelId:null,platformId:1,confidence:70},{id:"PF_RES_NIV",type:"platform",pattern:"aircurve\\s*10|lumis|vpap",modelId:null,platformId:2,confidence:70},{id:"PF_PHI_DS",type:"platform",pattern:"dreamstation|\\bds2\\b|remstar",modelId:null,platformId:3,confidence:65},{id:"PF_PHI_NIV",type:"platform",pattern:"bipap|trilogy|avaps|autosv",modelId:null,platformId:4,confidence:65},{id:"PF_LOW",type:"platform",pattern:"prisma|lowenstein|weinmann|somno",modelId:null,platformId:5,confidence:60},{id:"PF_BRE",type:"platform",pattern:"breas|\\bvivo\\b",modelId:null,platformId:6,confidence:60},{id:"PF_BMC",type:"platform",pattern:"\\bbmc\\b|瑞迈特|\\bg3\\b|\\bgii\\b|\\by-\\d+\\b|\\bu-\\d+\\b",modelId:null,platformId:7,confidence:60},{id:"PF_YUW",type:"platform",pattern:"鱼跃|\\byh[-\\s]?\\d+\\b",modelId:null,platformId:9,confidence:55},{id:"RK_ASV_OVERCLAIM",type:"platform",pattern:"",modelId:null,platformId:null,confidence:null},{id:"RK_VT_OVERCLAIM",type:"platform",pattern:"",modelId:null,platformId:null,confidence:null},{id:"RK_PRICE_TOO_LOW",type:"platform",pattern:"",modelId:null,platformId:null,confidence:null},{id:"RK_KEYWORDS_REFURB",type:"platform",pattern:"",modelId:null,platformId:null,confidence:null},{id:"EV_NAMEPLATE_MATCH",type:"platform",pattern:"制造商.*resmed|philips|bmc|yuwell|lowenstein|breas",modelId:null,platformId:null,confidence:null},{id:"EV_SDCARD_SIGNATURE",type:"platform",pattern:"STR\\.edf|IDENTIFY|DATALOG|BMC",modelId:null,platformId:null,confidence:null},{id:"EV_UI_SIGNATURE",type:"platform",pattern:"(rotary|旋钮).*menu|prisma",modelId:null,platformId:10,confidence:50}],y=e=>{const n=(e=>{const n=[e.name,e.series||"",e.platformFamily||"",(e.aliasNames||[]).join(" "),(e.modeTags||[]).join(" ")];return n.join(" ").toLowerCase()})(e),t=[];let a=0;return f.forEach(i=>{if(!i.pattern)return;if(!new RegExp(i.pattern,"i").test(n))return;if(i.platformId&&e.platformId&&i.platformId!==e.platformId)return;const r=i.confidence||("hard"===i.type?90:70);t.push({id:i.id,type:i.type,confidence:r}),r>a&&(a=r)}),{platformConfidence:a||void 0,platformRuleHits:t.map(e=>e.id),platformRuleNotes:t.map(e=>"hard"===e.type?"型号硬匹配":"平台匹配")}};let g=null,P=null,h=null,I=null,A=null;const v=async()=>{if(g)return g;try{const n=await e.getAll();if(200===n.code&&Array.isArray(n.data))return g=n.data,n.data}catch(s){}const t=[...n,...o],a=new Map;t.forEach(e=>{var n,t;const i=e.name.toLowerCase();if(!a.has(i))return void a.set(i,e);const r=a.get(i),s=(r.dataCompleteness||0)+((null==(n=r.sourcePaths)?void 0:n.length)||0),o=(e.dataCompleteness||0)+((null==(t=e.sourcePaths)?void 0:t.length)||0);a.set(i,o>=s?e:r)});const i=u(Array.from(a.values())).map(e=>({...e,...y(e)})),r=await T(i);return g=M(r),g},b=async t=>{if(g){const e=g.find(e=>e.id===t);if(e)return e}try{const n=await e.getById(t);if(200===n.code&&n.data)return n.data}catch(a){}return(g||M(await T(u([...n,...o]).map(e=>({...e,...y(e)}))))).find(e=>e.id===t)},M=e=>{const n=e.filter(e=>(e=>{if(e.deviceType)return!0;const n=`${e.name||""}`.toLowerCase(),t=`${e.type||""}`.toLowerCase();if(["面罩","过滤器","管路","配件","附件","湿化器","水箱","头带"].some(e=>n.includes(e)||t.includes(e)))return!1;if(["呼吸机","pap","cpap","apap","bipap","niv","无创","通气"].some(e=>n.includes(e)||t.includes(e)))return!0;const a=["CPAP","APAP","BIPAP","ST","S/T","AVAPS","IVAPS","ASV"];return(e.modeTags||[]).some(e=>a.includes(e.toUpperCase()))})(e)).map(e=>{var n,t;return{...e,brand:N(e.brand||""),series:null==(n=e.series)?void 0:n.trim(),type:null==(t=e.type)?void 0:t.trim(),dataCompleteness:Math.max(e.dataCompleteness||0,_(e)),image:S(e),images:void 0}});return V(n)},S=e=>e.image&&e.image.startsWith("/images/products/")||e.image&&/^https?:\/\//.test(e.image)?e.image:G(e),_=e=>{var n,t;let a=40;return e.deviceType&&(a+=8),(null==(n=e.modeTags)?void 0:n.length)&&(a+=10),e.specs&&Object.keys(e.specs).length>=3&&(a+=10),(null==(t=e.specs)?void 0:t["官方页面"])&&(a+=8),e.series&&(a+=4),e.image&&/^https?:\/\//.test(e.image)&&(a+=12),(e.epapMin||e.epapMax||e.ipapMax)&&(a+=8),Math.min(95,a)},C=e=>e.toLowerCase().replace(/[™®©]/g,"").replace(/[\s\-_()［］【】\[\].,/]+/g,""),R=e=>{if("number"==typeof e&&e>0)return e;const n=[...String(e||"").matchAll(/(?:¥|￥|US\$|\$)?\s*(\d+(?:\.\d+)?)/g)].map(e=>Number(e[1])).filter(e=>Number.isFinite(e)&&e>50);return n.length?1===n.length?n[0]:(n.sort((e,n)=>e-n),(n[0]+n[n.length-1])/2):0},w=async e=>{const n=["https://ai.airivo.cn/data/respirators","/data/respirators"];for(const t of n)try{const n=await fetch(`${t}/${e}?t=${Date.now()}`,{cache:"no-store"});if(n.ok)return await n.json()}catch{}return null},T=async e=>{const[n,t,a]=await Promise.all([w("domestic.json"),w("imported.json"),w("free_market_prices.json")]),i=e.map(e=>({...e}));[...Array.isArray(n)?n:[],...Array.isArray(t)?t:[]].forEach(e=>{var n,t;const a=N(e.brand||""),r=(e.model||"").trim();if(!a||!r)return;const s=i.find(e=>N(e.brand||"")===a&&(C(e.name||"").includes(C(r))||C(r).includes(C(e.name||""))));if(!s)return;const o=R(e.price);(s.price||0)<=0&&o>0&&(s.price=Math.round(o)),s.highlights=H(s.highlights,[...e.features||[],e.pressure_range?`压力范围 ${e.pressure_range}`:""]).slice(0,8),s.specs=O(s.specs,{"压力范围":(null==(n=s.specs)?void 0:n["压力范围"])||e.pressure_range,"快照参考价":(null==(t=s.specs)?void 0:t["快照参考价"])||e.price||""}),s.sourceTypes=H(s.sourceTypes,["爬虫"]),s.sourcePaths=H(s.sourcePaths,["respirators/domestic.json","respirators/imported.json"]),s.dataCompleteness=Math.min(95,Math.max(s.dataCompleteness||0,84))});const r=Object.values((null==a?void 0:a.platforms)||{}).flatMap(e=>e.offers||[]).map(e=>{var n;return{title:e.title||"",price:R(null==(n=e.prices)?void 0:n[0]),url:e.url||""}}).filter(e=>e.title&&e.price>0);return i.forEach(e=>{const n=C(N(e.brand||"")),t=(e=>{const n=e||"",t=n.match(/[A-Za-z]+\d+[A-Za-z0-9-]*/g)||[],a=n.split(/\s+/).slice(0,2).join(" ");return Array.from(new Set([n,a,...t].map(e=>C(e)).filter(Boolean)))})(e.name||""),a=r.filter(e=>{const a=C(e.title);return a.includes(n)&&t.some(e=>e&&a.includes(e))});if(!a.length)return;const i=a.map(e=>e.price).filter(Boolean).sort((e,n)=>e-n),s=i[Math.floor(i.length/2)]||0;(e.price||0)<=0&&s>0&&(e.price=Math.round(s)),e.specs=O(e.specs,{"市场参考价":s>0?`¥${Math.round(s)}`:void 0,"市场样本数":String(a.length)}),e.sourceTypes=H(e.sourceTypes,["爬虫"]),e.sourcePaths=H(e.sourcePaths,a.map(e=>e.url).filter(Boolean).slice(0,2)),e.dataCompleteness=Math.min(95,Math.max(e.dataCompleteness||0,88))}),i},E=e=>{var n;let t=e.dataCompleteness||0;return e.image&&/^https?:\/\//.test(e.image)&&(t+=20),(null==(n=e.specs)?void 0:n["官方页面"])&&(t+=10),e.price&&(t+=2),(e.epapMin||e.epapMax||e.ipapMax)&&(t+=2),t},H=(e,n)=>{const t=[...e||[],...n||[]];return Array.from(new Set(t))},O=(e,n)=>({...e||{},...n||{}}),N=e=>{const n=e.trim();if(!n)return n;const t=n.toLowerCase();return t.includes("resmed")?"瑞思迈":t.includes("philips")?"飞利浦伟康":t.includes("bmc")?"瑞迈特":t.includes("yuwell")?"鱼跃":t.includes("fisher")||t.includes("paykel")?"费雪派克":t.includes("löwenstein")||t.includes("lowenstein")?"律维施泰因":t.includes("breas")?"博毅雅":t.includes("devilbiss")||t.includes("drive")?"德威比斯":t.includes("apex")||t.includes("wellell")?"亚培克斯":n},V=e=>{const n=new Map;return e.forEach(e=>{const t=C(e.brand||""),a=[e.name,...e.aliasNames||[]].filter(Boolean).map(e=>`${t}_${C(String(e))}`);let i;for(const d of a){const e=n.get(d);if(e){i=e;break}}if(!i)return void a.forEach(t=>n.set(t,e));const r=E(e)>=E(i)?e:i,s=r===e?i:e,o={...s,...r,highlights:H(s.highlights,r.highlights),modeTags:H(s.modeTags,r.modeTags),suitableFor:H(s.suitableFor,r.suitableFor),aliasNames:H(s.aliasNames,r.aliasNames),sourceTypes:H(s.sourceTypes,r.sourceTypes),sourcePaths:H(s.sourcePaths,r.sourcePaths),specs:O(s.specs,r.specs)};a.forEach(e=>n.set(e,o))}),Array.from(new Set(n.values()))},G=e=>"PAP_SLEEP"===e.deviceType?"/images/product-pap.svg":"NIV_HOME"===e.deviceType?"/images/product-niv.svg":"PAP_TRAVEL"===e.deviceType?"/images/product-travel.svg":"/images/product-pap.svg",k=async()=>{if(P)return P;try{const e=await i.getAll();if(200===e.code&&Array.isArray(e.data))return P=e.data,e.data}catch(e){}return P=l,P},D=async e=>{if(P){const n=P.find(n=>n.id===e);if(n)return n}try{const n=await i.getById(e);if(200===n.code&&n.data)return n.data}catch(n){}return(P||l).find(n=>n.id===e)},B=async()=>{if(h)return h;try{const e=await r.getAll();if(200===e.code&&Array.isArray(e.data))return h=e.data,e.data}catch(e){}return h=c,h},L=async e=>{if(h){const n=h.find(n=>n.id===e);if(n)return n}try{const n=await r.getById(e);if(200===n.code&&n.data)return n.data}catch(n){}return(h||c).find(n=>n.id===e)},F=async()=>{if(I)return I;try{const e=await t.getAll();if(200===e.code&&Array.isArray(e.data))return I=e.data,e.data}catch(i){}const e=[...a,...d],n=new Map;return e.forEach(e=>{const t=e.name.toLowerCase();n.has(t)||n.set(t,e)}),I=Array.from(n.values()),I},x=async e=>{if(I){const n=I.find(n=>n.id===e);if(n)return n}try{const n=await t.getById(e);if(200===n.code&&n.data)return n.data}catch(n){}return(I||[...a,...d]).find(n=>n.id===e)},j=async()=>{if(A)return A;try{const e=await s.getAll();if(200===e.code&&Array.isArray(e.data))return A=e.data.map(e=>{var n;return{...e,productName:e.productName||"产品",productId:e.productId||(null==(n=e.product)?void 0:n._id)||e.product||0}}),A}catch(e){}return A=o.flatMap(e=>(e.reviews||[]).map(n=>({...n,productId:e.id,productName:e.name}))),A};export{F as a,k as b,B as c,j as d,b as e,v as f,x as g,D as h,L as i};
